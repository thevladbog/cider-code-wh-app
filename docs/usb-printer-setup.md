# Настройка USB принтеров

В приложении реализована поддержка как сетевых, так и USB принтеров для печати этикеток. Данный документ описывает настройку и использование USB принтеров.

## Требования

Для полноценной работы с USB принтерами требуется установка дополнительных библиотек:

```bash
# Для работы с USB устройствами
npm install usb --save

# Альтернативно, для работы с последовательными портами
npm install serialport --save
```

## Установка принтера

1. Откройте настройки принтеров в приложении.
2. Нажмите кнопку "Добавить принтер".
3. Введите название принтера.
4. Выберите тип подключения "USB".
5. Нажмите кнопку "Обновить" для получения списка доступных USB устройств.
6. Используйте поле поиска для фильтрации списка устройств, если их много.
7. Выберите нужное устройство из выпадающего списка или введите путь вручную.
8. При необходимости отметьте принтер как "По умолчанию".
9. Нажмите "Добавить" для сохранения принтера.
10. Используйте кнопку "Проверить подключение" для тестирования соединения.

## Как распознаются USB принтеры

Приложение использует несколько методов для обнаружения потенциальных USB принтеров:

1. **По производителю**: устройства от известных производителей принтеров (Zebra, Epson, Brother, HP и др.).
2. **По классу устройства**: устройства, которые относятся к классу принтеров или коммуникационных устройств.
3. **По описанию**: устройства, в описании которых содержатся ключевые слова, связанные с принтерами.

Если вы не видите свой принтер в списке, вы можете ввести путь вручную, зная USB VID/PID устройства.

## Формат пути к USB устройству

Путь к USB устройству имеет следующий формат:
- `usb://vendorID/productID` - универсальный формат, где vendorID и productID - это шестнадцатеричные идентификаторы устройства (например, `usb://04b8/0e15` для Epson TM-T88V)

Альтернативные форматы для специфичных случаев:
- Windows: `COM10` (для последовательных USB-принтеров)
- Linux: `/dev/usb/lp0` или `/dev/ttyUSB0`
- macOS: `/dev/usbserial-1410`

## Отладка USB принтеров

Для отладки USB принтеров рекомендуется:

1. Просмотр логов приложения:
   - В режиме разработки логи доступны в консоли DevTools
   - В production логи сохраняются в каталоге `userData/logs`

2. Проверка USB устройств в системе:
   - Windows: диспетчер устройств
   - Linux: `lsusb`
   - macOS: System Information -> USB

3. Проверка прав доступа к USB устройствам для приложения в случае ошибок доступа.

## Решение проблем

### Принтер не определяется как USB-устройство

1. Убедитесь, что принтер подключен и включен.
2. Проверьте, видит ли система ваше устройство (через диспетчер устройств в Windows).
3. Найдите VID/PID принтера (VendorID/ProductID):
   - Windows: через диспетчер устройств -> свойства устройства -> сведения -> ИД оборудования
   - Linux: через команду `lsusb`
   - macOS: через System Information -> USB
4. Введите путь вручную в формате `usb://vendorID/productID`, используя найденные идентификаторы.

### Ошибки при отправке заданий на печать

1. Убедитесь, что принтер готов к печати (включен, есть бумага, нет ошибок).
2. Проверьте соответствие формата ZPL с документацией вашего принтера.
3. Проверьте журнал ошибок приложения на наличие сообщений от USB-драйвера.
4. Попробуйте перезапустить принтер и приложение.

## Дополнительные ресурсы

- [USB devices in Electron](https://www.electronjs.org/docs/latest/tutorial/devices#usb-devices)
- [node-usb documentation](https://github.com/node-usb/node-usb)
- [serialport documentation](https://serialport.io/docs/)
- [ZPL Programming Guide](https://support.zebra.com/cpws/docs/zpl/zpl_manual.pdf)
